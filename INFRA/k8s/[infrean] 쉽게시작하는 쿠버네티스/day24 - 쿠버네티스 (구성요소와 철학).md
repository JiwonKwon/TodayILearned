# day24 - 쿠버네티스 (구성요소와 철학)

인프런 : 쉽게 시작하는 쿠버네티스(v1.25)

# 3.1.쿠버네티스 구성 요소 확인(+EKS,AKS,GKE 관리형 쿠버네티스)

## 쿠버네티스를 구성하는 것들

<img width="987" alt="스크린샷 2023-02-12 오후 6 30 46" src="https://user-images.githubusercontent.com/44457591/218304617-dc03d5d5-1b2b-4209-aa2a-53bb48f948f6.png">

→ 이런 다양한 것들이 있는데.. 강의를 듣다보면 이거구나 싶은 때가 온다.


<img width="1032" alt="스크린샷 2023-02-12 오후 6 31 14" src="https://user-images.githubusercontent.com/44457591/218304626-d12d93c9-7a4f-4cd9-afba-a9e97f68ac71.png">

- 네임스페이스 : 쿠버네티스에서 나눠쓰는 구역. 아파트 호실 느낌으로 생각하는게 좋다. 101호 102호처럼 격리된 느낌
    - default 네임스페이스 : 강의에서 배포한 nginx, check host 는 기본 namespace에 구성함.
    - kube-system 네임스페이스 :  첫번째 그림에 나온 쿠버네티스의 기본적 구성요소는 kube-system 에 있다. → apiserver, etcd, kube-proxy 등등

---

EKS, AKS, GKE에서 기본설정으로 배포하고 Kube-system 네임스페이스를 확인한 모습

AWS EKS

<img width="1398" alt="스크린샷 2023-02-12 오후 6 40 25" src="https://user-images.githubusercontent.com/44457591/218304663-5cedfdd1-c9a8-4051-837a-2b5b3e660de3.png">

Azure AKS

<img width="1615" alt="스크린샷 2023-02-12 오후 6 38 19" src="https://user-images.githubusercontent.com/44457591/218304643-774ae955-72ef-4a7f-9bd7-ecac709e2fe5.png">


GCP GKE

<img width="1720" alt="스크린샷 2023-02-12 오후 6 39 36" src="https://user-images.githubusercontent.com/44457591/218304654-90e84c60-21ee-416c-904e-524760bbefc7.png">

요렇게 클라우드 3사에서 제공하는 Kube-System은 관리형 쿠버네티스로 모든 쿠버네티스 구성요소를 보여주지 않는다. 관리형 쿠버네티스에서 관리하는 마스터노드에서 보이지 않게 관리중이다. 사용자는 알필요가 없음.

# 3.2.쿠버네티스의 기본 철학

쿠버네티스를 구성하는 주요한 요소를 설명하기 위해 쿠버네티스의 철학을 이해할 필요가 있음.

**쿠버네티스의 기본 철학**

MSA 형태로 되어있음. 하는일들이 개별적으로 나뉘어 있음. 공장의 컨베이어 벨트처럼 각각의 일이 분리되어있음.

파드 배포시에 쿠버네티스 구성요소가 하는일

<img width="1722" alt="스크린샷 2023-02-12 오후 6 47 41" src="https://user-images.githubusercontent.com/44457591/218304673-906c434b-a2c3-4837-9f9c-18252d93eb1b.png">


명령을 하고, 명령에 응답하는 형식이 아님. 보일러처럼 선언적으로 값을 두고 맞추려고 하는 시스템.

API 서버는 중앙에서 상태값을 가지고 있고, 컨트롤 매니저 & 스케줄러 & kubelet 등이 그 상태값을 맞춰넣는 방식으로 동작을 한다. = 선언적인 시스템

<img width="1694" alt="스크린샷 2023-02-12 오후 6 49 25" src="https://user-images.githubusercontent.com/44457591/218304689-49a423f8-6320-42df-8c48-95f3f338fe25.png">


쿠버네티스의 각 요소들은 해야될 일만 함.

API서버는 시스템의 값만 가지고 있음. 이 값을 보고 각 요소들은 값을 맞추려고 함.

# 3.3.실제 쿠버네티스의 파드 배포 흐름

<img width="833" alt="스크린샷 2023-02-12 오후 6 54 32" src="https://user-images.githubusercontent.com/44457591/218304700-6eea2b33-54dd-4f28-ae64-7eae98c5c508.png">

1. 개발자/관리자가 kubectl 명령어를 통해 API서버에 요청을 한다.
2. API서버는 etcd에 해당 정보를 sync한다. 문제가 생기면 복구할 수 있는 방법은 etcd에 있다. 복원하면 값을 모두 가지고 있음.
3. api서버의 값을 보고 컨트롤러 매니저가 그에 맞게 자신의 값을 바꾸고 api서버를 업데이트한다.
4. 스케줄러는 실제 파드가 각각의 워커노드에 밸런스있게 들어가도록 해줌. 스케줄러가 api서버에 상태값을 보고 값을 업데이트 해놓음.
5. kubelet이 실제로 Pod을 생성하기 위해 컨테이너 런타임에 파드 생성을 요청함.
6. 컨테이너 런타임이 pod를 생성한다.
7. 생성된 파드들은 실제로 사용자와 통신하기위해 kube-proxy 를 통해 통신한다.

+)네트워크는 컨테이너 네트워크 인터페이스를 통해 네트워크 플러그인을 선택적으로 사용할 수 있고, 강의에서는 calico를 사용중.
